<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>이관글 관리</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main class="container">
      <div class="filter-container">
        <div class="filter-item">
          <label for="dropdown">이관글 번호</label>
          <select id="dropdown"></select>
        </div>
        <div class="filter-item">
          <label for="date">이관글 발송 날짜</label>
          <input type="date" id="date" />
        </div>
        <div class="filter-item">
          <label for="request-period">쿠팡확인요청 접수 기간</label>
          <p id="request-period"></p>
        </div>
        <div class="filter-item">
          <label for="required-evidence">필요 증빙</label>
          <p id="required-evidence"></p>
        </div>
        <div class="filter-item">
          <label for="related-guide">관련 가이드</label>
          <p id="related-guide"></p>
        </div>
      </div>
      <div class="table-container">
        <table id="rows-table" class="data-table"></table>
      </div>
    </main>
    <script type="module">
      import { DROP_DOWN_LIST, ROWS } from "./data.js";
      import {
        renderDropdown,
        renderTable,
        getRequestPeriodText,
        createGuideLink,
        createEvidenceList,
        filterRowsByNo,
      } from "./utils.js";

      const dropdown = document.getElementById("dropdown");
      const table = document.getElementById("rows-table");
      const dateInput = document.getElementById("date");
      const requestPeriodEl = document.getElementById("request-period");
      const requiredEvidenceEl = document.getElementById("required-evidence");
      const relatedGuideEl = document.getElementById("related-guide");

      // 쿠팡확인요청 접수 기간 업데이트
      const updateRequestPeriod = () => {
        const value = dateInput.value;
        if (!value) {
          requestPeriodEl.textContent = "";
          return;
        }

        const selectedDate = new Date(value);
        if (Number.isNaN(selectedDate.getTime())) {
          requestPeriodEl.textContent = "";
          return;
        }

        const label = getRequestPeriodText(selectedDate);
        requestPeriodEl.textContent = label;
      };

      // 필요 증빙 및 관련 가이드 업데이트
      const updateConditionalFromRow = (row) => {
        // 초기화
        relatedGuideEl.innerHTML = "";
        requiredEvidenceEl.innerHTML = "";

        if (!row) {
          return;
        }

        // 관련 가이드
        const guideEl = createGuideLink(row.guide, row.guideLink);
        if (guideEl) {
          relatedGuideEl.appendChild(guideEl);
        }

        // 필요 증빙
        const evidenceListEl = createEvidenceList(row.evidenceList);
        if (evidenceListEl) {
          requiredEvidenceEl.appendChild(evidenceListEl);
        } else {
          requiredEvidenceEl.textContent = "-";
        }
      };

      // 이관글 번호 선택 시 필터링 및 업데이트
      const handleDropdownChange = () => {
        const value = dropdown.value;
        const selectedNo = Number(value);

        if (!value || Number.isNaN(selectedNo)) {
          renderTable(table, ROWS);
          updateConditionalFromRow(null);
          return;
        }

        const filteredRows = filterRowsByNo(ROWS, selectedNo);
        renderTable(table, filteredRows);
        updateConditionalFromRow(filteredRows[0] ?? null);
      };

      dateInput.addEventListener("change", updateRequestPeriod);
      dropdown.addEventListener("change", handleDropdownChange);

      renderDropdown(dropdown, DROP_DOWN_LIST);
      renderTable(table, ROWS);
      updateRequestPeriod();
      updateConditionalFromRow(null);
    </script>
  </body>
</html>

